<!DOCTYPE html>
<html>

<head>
    <title>Jams</title>
    <style>
        html,
        body {
            height: 100%;
            width: 100%;
        }

        body {
            background-color: #efefef;
            color: #222;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1em;
        }

        #main {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: row;
        }

        select {
            flex: 1;
            color: inherit;
            appearance: none;
            outline: none;
            border: 0px;
            border-radius: 0.5em;
            margin: 0.2em;
            padding: 0.2em;
            background: none;
            font-size: 1.5em;
            text-align: center;
        }

        .spin-done {
            background: #fff;
        }

        button {
            background-color: #fff;
            padding: 0.5em 1em;
            text-decoration: none;
            font-size: 1.2em;
            margin: 0.5em;
            cursor: pointer;
            border: 0;
            border-radius: 0.5em;
        }

        button:disabled {
            opacity: 0.5;
        }

        @media (pointer:none),
        (pointer:coarse) {

            /* Styles for screens wider than mobile */
            /* Add your CSS rules here */
            body {
                font-size: 2em;
            }

            #main {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <h1>Skill Jam</h1>
    <div id="main">
        <select id="main-theme">
            <option disabled selected>Main Theme</option>
        </select>
        <select id="sub-theme">
            <option disabled selected>Sub Theme</option>
        </select>
        <select id="skills">
            <option disabled selected>Skill</option>
        </select>
        <button id="spinButton" onclick="spin()">Spin!</button>
    </div>
    <script>
        function noise(i, seed = 0){
            i *= 0xb5297a4d;
            i += seed;
            i ^= i >> 8;
            i += 0x68e31da4;
            i ^= i << 8;
            i *= 0x1b56c4e9;
            i ^= i >> 8;
            return (i % Number.MAX_SAFE_INTEGER) / Number.MAX_SAFE_INTEGER;
        }
        function randFromDate(seed = 0, date = new Date()) {
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            // adds the month as the last 2 digits of the year
            // ex: July 2023 (7/2023) would be 202307
            return noise(year * 100 + month, seed);
        }

        function shuffleArray(array, seed = 0) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(randFromDate(seed + i) * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        const skills = [
            "ðŸŽ¨ Art",
            "ðŸŽµ Music",
            "ðŸ“š Story",
            "ðŸ’» Programming"
        ]
        const themes = [
            "Space", "Medieval", "Horror", "Fantasy", "Cyberpunk", "Pirate", "Wild West", "Underwater", "Time Travel",
            "Post-Apocalyptic", "Fairy Tale", "Steampunk", "Mystery", "Romance", "Comedy", "Tragedy", "Adventure", "Sci-Fi",
            "Historical", "Military", "Alien Invasion", "Zombie Apocalypse", "Superheroes", "Villains", "Magic and Sorcery",
            "Espionage", "Survival", "War", "Ninja", "Robot Uprising", "Urban", "Country", "Jungle", "Desert", "Arctic",
            "Vampire", "Werewolf", "Monster", "Demon", "Angel", "Mythology", "Religious", "Political", "Educational",
            "Family", "Kids", "Teen", "Adult", "Old Age", "Virtual Reality", "Augmented Reality", "Dreams", "Nightmares",
            "Dinosaurs", "Mutants", "Cyborgs", "Future", "Past", "Present", "Sports", "Racing", "Flight", "Detective",
            "Spy", "Murder Mystery", "Heist", "Rescue Mission", "Treasure Hunt", "Epic Quest", "End of the World",
            "Beginning of the World", "Rebellion", "Empire", "Kingdom", "Colony", "Tribal", "Animal", "Insect", "Plant",
            "Mineral", "Elemental", "Mechanical", "Digital", "Undead", "Ghost", "Witch", "Wizard", "Circus", "Festival",
            "Holiday", "Seasons", "Weather", "Disaster", "Celebration", "Science", "Technology", "Nature", "Supernatural",
            "Mythical Creatures", "Realistic", "Unrealistic", "Abstract", "Concrete", "Bright", "Dark", "Loud", "Quiet",
            "Fast", "Slow", "Big", "Small"
        ];

        function populateOptions(id, items, seed = Math.random() * Number.MAX_SAFE_INTEGER) {
            const shuffled = shuffleArray(items, seed);
            const select = document.getElementById(id);
            for (let i = 0; i < shuffled.length; i++) {
                let option = document.createElement("option");
                option.text = shuffled[i];
                select.add(option);
            }
        }

        populateOptions("main-theme", themes, 0);
        populateOptions("sub-theme", themes);
        populateOptions("skills", skills);

        function spin() {
            const spinButton = document.getElementById("spinButton");
            const mainThemeSelect = document.getElementById('main-theme')?.querySelector("option[disabled]")?.remove();
            const subThemeSelect = document.getElementById('sub-theme')?.querySelector("option[disabled]")?.remove();
            const skillSelect = document.getElementById('skills')?.querySelector("option[disabled]")?.remove();
            

            spinButton.disabled = true;
            console.log(spinButton)
            Promise.all([
                spinSelect('main-theme', 1),
                spinSelect('sub-theme'),
                spinSelect('skills'),
                
            ]).then(() => {
                spinButton.disabled = false;
            })
        }

        function spinSelect(id, seed = Math.random() * Number.MAX_SAFE_INTEGER) {
            return new Promise((res) => {
                const select = document.getElementById(id);
                select.classList.remove("spin-done");
                const length = select.options.length;
                let speed = randFromDate(seed) * 10.0 + length + 2.0; // choose a random starting speed between 0.02 and 0.05
                let index = randFromDate(seed + 1) * length;
                const friction = 0.99; // choose a friction factor
                let lastTime = Date.now();
                // Start at a random index
                select.selectedIndex = Math.floor(index);

                function step() {
                    const delta = (Date.now() - lastTime) / 1000; // calculate the elapsed time
                    lastTime = Date.now();
                    speed *= friction; // apply friction to the speed
                    index += speed * delta; // interpolate the index
                    select.selectedIndex = Math.floor(index) % length;
                    if (speed < 1.0) {
                        res();
                        select.classList.add("spin-done");
                        return;
                    }
                    requestAnimationFrame(step); // schedule the next step for the next animation fram
                }
                step(); // start the spin
            });
        }
    </script>
</body>

</html>